{"version":3,"sources":["webpack:///./client/pages/ForumPage.js"],"names":["ForumPage","props","threadId","match","params","dispatch","useDispatch","user","useSelector","state","auth","useState","showLoader","setShowLoader","name","type","answers","createdAt","Date","firstName","lastName","image","forumThread","setForumThread","forumMessages","setForumMessages","deleteMessage","id","index","conf","window","confirm","deleteForumMessage","onSuccess","res","newMessages","splice","useEffect","getForumThread","data","onEnd","getForumMessages","renderMessages","map","message","messageIndex","_id","role","moment","fromNow","width","height","objectFit","backgroundColor","sendingMessage","setSendingMessage","initialFormValues","setInitialFormValues","onSendMessage","values","resetForm","body","thread","answerForumThread","renderReplyForm","Yup","required","padding","borderRadius","TextError","marginTop","marginBottom"],"mappings":"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","file":"pages-ForumPage.59830d5a53d127ef3344.js","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\n\r\nimport { Formik, Form, Field, ErrorMessage } from \"formik\";\r\nimport * as Yup from \"yup\";\r\nimport TextError from \"../shared/TextError\";\r\n\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\n\r\nimport {\r\n  getForumThread,\r\n  answerForumThread,\r\n  getForumMessages,\r\n  deleteForumMessage,\r\n} from \"../store/api/forum\";\r\n\r\nimport moment from \"moment\";\r\n\r\nconst ForumPage = (props) => {\r\n  const { threadId } = props.match.params;\r\n  const dispatch = useDispatch();\r\n\r\n  const user = useSelector((state) => state.auth.user);\r\n  const [showLoader, setShowLoader] = useState(false);\r\n  const [forumThread, setForumThread] = useState({\r\n    name: \"\",\r\n    type: \"\",\r\n    answers: 0,\r\n    createdAt: new Date(),\r\n    user: {\r\n      firstName: \"\",\r\n      lastName: \"\",\r\n      image: \"\",\r\n    },\r\n  });\r\n  const [forumMessages, setForumMessages] = useState([]);\r\n\r\n  const deleteMessage = (id, index) => {\r\n    const conf = window.confirm(\"Are you sure you want to delete?\");\r\n\r\n    if (!conf) return;\r\n    dispatch(\r\n      deleteForumMessage({\r\n        id,\r\n        onSuccess: (res) => {\r\n          const newMessages = [...forumMessages];\r\n          newMessages.splice(index, 1);\r\n          setForumMessages(newMessages);\r\n        },\r\n      })\r\n    );\r\n  };\r\n  useEffect(() => {\r\n    setShowLoader(true);\r\n    dispatch(\r\n      getForumThread({\r\n        threadId,\r\n        onSuccess: (res) => {\r\n          setForumMessages([{ ...res.data.data, user }, ...forumMessages]);\r\n          setForumThread(res.data.data);\r\n        },\r\n        onEnd: () => {\r\n          setShowLoader(false);\r\n        },\r\n      })\r\n    );\r\n\r\n    dispatch(\r\n      getForumMessages({\r\n        threadId,\r\n        onSuccess: (res) => {\r\n          setForumMessages(res.data.data);\r\n        },\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  const renderMessages = () => {\r\n    return forumMessages.map((message, messageIndex) => {\r\n      return (\r\n        <div className=\"form_cover\" key={`${message._id} + ${messageIndex}`}>\r\n          <div className=\"row\">\r\n            <div className=\"col-12 align-self-center\">\r\n              {user && user.role === \"ADMIN\" && (\r\n                <button\r\n                  className=\"btn btn-danger float-right\"\r\n                  onClick={() => {\r\n                    deleteMessage(message._id, messageIndex);\r\n                  }}\r\n                >\r\n                  Delete\r\n                </button>\r\n              )}\r\n              <h3>{messageIndex + 1}</h3>\r\n              <p>{message.message}</p>\r\n            </div>\r\n            <div className=\"col-lg-4 col-md-5 offset-md-7 offset-lg-8 col-12\">\r\n              <div className=\"card\">\r\n                <div className=\"card-body\">\r\n                  <div className=\"left_block\">\r\n                    <p>\r\n                      <span>{`${message.user.firstName} ${message.user.lastName}`}</span>\r\n                      {`${\r\n                        forumThread.type === \"question\" ? \"Answered\" : \"Replied\"\r\n                      } ${moment(message.createdAt).fromNow()}`}\r\n                    </p>\r\n                  </div>\r\n                  <div className=\"right_block\">\r\n                    <img\r\n                      src={message.user.image}\r\n                      alt=\"\"\r\n                      className=\"img-fluid\"\r\n                      style={{\r\n                        width: \"64px\",\r\n                        height: \"64px\",\r\n                        objectFit: \"cover\",\r\n                        backgroundColor: \"#ccc\",\r\n                      }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  const [sendingMessage, setSendingMessage] = useState(false);\r\n  const [initialFormValues, setInitialFormValues] = useState({\r\n    message: \"\",\r\n  });\r\n  const onSendMessage = (values, { resetForm }) => {\r\n    if (sendingMessage) return;\r\n    const body = { ...values, thread: threadId };\r\n\r\n    setSendingMessage(true);\r\n    dispatch(\r\n      answerForumThread({\r\n        body,\r\n        onSuccess: (res) => {\r\n          setForumMessages([\r\n            ...forumMessages,\r\n            { ...res.data.data, user: user },\r\n          ]);\r\n          resetForm();\r\n        },\r\n        onEnd: () => {\r\n          setSendingMessage(false);\r\n        },\r\n      })\r\n    );\r\n  };\r\n\r\n  const renderReplyForm = () => {\r\n    return (\r\n      <Formik\r\n        validationSchema={Yup.object({\r\n          message: Yup.string().required(\"Message is required.\"),\r\n        })}\r\n        enableReinitialize={true}\r\n        initialValues={initialFormValues}\r\n        onSubmit={onSendMessage}\r\n      >\r\n        {() => {\r\n          return (\r\n            <Form>\r\n              <div\r\n                style={{\r\n                  backgroundColor: \"#ccc\",\r\n                  padding: \"3px\",\r\n                  borderRadius: \"3px\",\r\n                }}\r\n              >\r\n                <div className=\"covering m-0\">\r\n                  <Field\r\n                    className=\"form-control border-none\"\r\n                    placeholder=\"Write your opinion...\"\r\n                    name=\"message\"\r\n                    as=\"textarea\"\r\n                  />\r\n                  <ErrorMessage name=\"message\" component={TextError} />\r\n                </div>\r\n                <div\r\n                  className=\"text-right\"\r\n                  style={{ marginTop: \"3px\", marginBottom: \"1px\" }}\r\n                >\r\n                  <button type=\"submit\" className=\"btn btn-primary\">\r\n                    Send <i className=\"fas fa-paper-plane\"></i>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </Form>\r\n          );\r\n        }}\r\n      </Formik>\r\n    );\r\n  };\r\n  return (\r\n    <>\r\n      <section className=\"other_banner\">\r\n        <div className=\"container\">\r\n          <h1>Forum</h1>\r\n        </div>\r\n      </section>\r\n      <section className=\"form_sec\">\r\n        <div className=\"container\">\r\n          <div className=\"form_cover\">\r\n            <div className=\"row\">\r\n              <div className=\"col-lg-10 col-md-10 col-12 align-self-center\">\r\n                <h2>{forumThread.name}</h2>\r\n                <p>\r\n                  <span>\r\n                    {forumThread.answers}{\" \"}\r\n                    {forumThread.type === \"question\" ? \"Answers\" : \"Replies\"}\r\n                  </span>\r\n                  <span className=\"spaced\">\r\n                    {forumThread.type === \"question\"\r\n                      ? `Asked ${moment(forumThread.createdAt).fromNow()}`\r\n                      : `Started Discussion ${moment(\r\n                          forumThread.createdAt\r\n                        ).fromNow()}`}\r\n                  </span>\r\n                </p>\r\n              </div>\r\n              <div className=\"col-lg-2 col-md-2 col-12\">\r\n                <img\r\n                  src={forumThread.user.image}\r\n                  alt=\"\"\r\n                  className=\"img-fluid\"\r\n                  style={{\r\n                    width: \"64px\",\r\n                    height: \"64px\",\r\n                    objectFit: \"cover\",\r\n                    backgroundColor: \"#ccc\",\r\n                  }}\r\n                />\r\n                <p className=\"name\">\r\n                  {forumThread.user.firstName + \" \" + forumThread.user.lastName}\r\n                </p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          {renderMessages()}\r\n          {renderReplyForm()}\r\n        </div>\r\n      </section>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ForumPage;\r\n"],"sourceRoot":""}